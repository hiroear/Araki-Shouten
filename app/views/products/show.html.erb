<!--商品詳細閲覧ページ-->

<div class="d-flex justify-content-center">
  <div class="row w-75">
    <div class="col-5 offset-1">
      <% if @product.image.attached? %>
        <%= image_tag @product.image, class: "w-100 img-fluid" %>
      <% else %>
        <%= image_tag "/images/dummy.png", class: "w-100 img-fuild" %>
      <% end %>
    </div>

    <div class="col">
      <div class="d-flex flex-column">
        <h1 class="">
          <%= @product.name %>
        </h1>
        <p class="">
          <%= @product.description %>
        </p>
        <hr>
        <p class="d-flex align-items-end">
          ￥<%= @product.price %>（税込）
        </p>
        <hr>
      </div>

      <% if user_signed_in? %> <!--ログインしていたら-->
        <%= form_with url: cart_users_path, local: true do |f| %>
          <%= f.hidden_field :product_id, value: @product.id %><!--product.idを hiddenで送信-->
          <%= f.hidden_field :name, value: @product.name %><!--product.nameを hiddenで送信　【これ必要？】-->
          <%= f.hidden_field :price, value: @product.price %><!--product.priceを hiddenで送信-->
          <div class="form-group row">
            <%= f.label "数量", class: "col-sm-2 col-form-label" %>
            <div class="col-sm-10">
              <%= f.number_field :quantity, min:1, value:1, class: "form-control w-25"%>
              <!--f.number_field: 数字をプルダウンで選択するフォームを作成。quantity:オブジェクト名, min:オプション、最小値。value:デフォルトの表示-->
            </div>
          </div>
          <div class="row">
            <div class="col-7">
              <%= f.submit "カートに追加", class: "btn samazon-submit-button w-100" do %>
                <i class="fas fa-shopping-cart"></i>
              <% end %>
            </div>
            <div class="col-5">
              <%= link_to favorite_product_path, class: "btn samazon-favorite-button text-favorite w-100" do %>
                <i class="fa fa-heart"></i><%= current_user.likes?(@product) ? "お気に入り解除" : "お気に入り" %>
                  <!--ログインユーザーが変数@productに格納されている商品を「いいね」しているか?-->
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

    <div class="offset-1 col-11">
      <hr class="w-100">
      <h3 class="float-left">カスタマーレビュー</h3>
    </div>

    <div class="offset-1 col-10"><!-- レビューを実装する箇所-->
      <div class="row">
        <% @reviews.each do |review| %>
          <div class="offset-md-5 col-md-5">
            <h3 class="review-score-color"><%= score_on_star(review.score) %></h3>
            <p class="h3"><%= review.content %></p>
            <h6><%= review.user.name %></h6>
            <p><%= l review.created_at %></p>
            <!--l（エル）メソッドを使ってレビューの投稿時間を表示。lメソッドは、アプリケーションのロケールに合わせて時間のフォーマットを指定できるメソッド-->
            <!--lメソッドを使用するにはロケールファイルが必要(config/locales/ja.yml)-->
          </div>
        <% end %>
      </div>
      
      <!--ログインしている場合のみレビュー用のフォームが表示される-->
      <% if user_signed_in? %>
        <div class="row">
          <div class="offset-md-3 col-md-9">
            <%= form_with model: @review, url: product_reviews_path(@product) do |f| %>
              <hr>
              <div class="row ml-1">
                <h5 class="review-h5">評価</h5>
                <%= f.select :score, @star_repeat_select, {}, class: "form-control review-score-color ml-3" %>
              </div>
              
              <h5 class="ml-3 mt-2">レビュー内容</h5>
              <%= f.text_area :content, class: "form-control m-2 ml-3" %>
              <%= f.submit "レビューを追加" , class:"btn samazon-submit-button ml-3"%>
              <hr>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>